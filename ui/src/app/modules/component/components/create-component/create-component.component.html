<div class="row">
    <div class="components-list-container m-0 border-right"
         [ngClass]="{'col p-0 h100 component-list-container-minimize':componentMinimize, 'col-3 px-3':!componentMinimize}">
        <button type="button" class="left-panel-minimize-btn btn btn-xs btn-default ms-2 shadow-none p-0"
                title="{{(componentMinimize ? 'global.actions.show' : 'global.actions.hide') | translate}}"
                (click)="componentMinimize = !componentMinimize;">
            <span class="fa" [ngClass]="{'fa-angle-double-right':componentMinimize, 'fa-angle-double-left':!componentMinimize}"></span>
        </button>
        <button type="button" class="btn btn-xs btn-default ms-2"
                [ngClass]="{'selected':viewComponent, 'not-selected':!viewComponent, 'd-none': componentMinimize}"
                (click)="viewComponent = true; cancel();">
            <span class="fa fa-cubes"></span> {{'components.menu.components' | translate}}
        </button>
        <button type="button" class="btn btn-xs btn-default"
                [ngClass]="{'selected':!viewComponent, 'not-selected':viewComponent, 'd-none': componentMinimize}"
                (click)="viewComponent = false; cancel();">
            <span class="fa fa-clone"></span> {{'components.menu.actions' | translate}}
        </button>

        <div *ngIf="viewComponent" class="component-list"
             [ngClass]="{'d-none': componentMinimize}">
            <div class="mb-2">
                <input name="search" type="text" class="form-control mb-2"
                       placeholder="{{'components.shared.list.filter.placeholder' | translate}}"
                       [(ngModel)]="componentFilter"/>
                <button *ngIf=" !isSelectAll()" type="button" class="btn btn-xs btn-default small-font"
                        (click)="selectAll()">
                    <span class="fa fa-check"></span> Tout sélectionner
                </button>
                <button *ngIf="isSelectAll()" type="button" class="btn btn-xs btn-default small-font"
                        (click)="unSelectAll()">
                    <span class="fa fa-times"></span> Tout désélectionner
                </button>
                <button class="chutney-tag"
                        [ngClass]="tagData.isNoTagSelected() ? 'chutney-tag-selected' : 'chutney-tag-unselected'"
                        (click)="toggleNoTag()">
                    NO_TAG
                </button>
                <div class="tags-scroll d-flex flex-wrap align-content-start">
                    <div *ngFor="let tag of tagData.all()">
                        <button
                            [ngClass]="tagData.isSelected(tag)? 'chutney-tag chutney-tag-selected' : 'chutney-tag chutney-tag-unselected'"
                            (click)="toggleTagSelect(tag)">
                            {{tag}}
                        </button>
                    </div>
                </div>
            </div>
            <hr/>
            <div class="table-scroll-with-tags-filter">
                <table class="table table-sm table-striped table-hover">
                    <tbody dragula="COPYABLE" id="left"
                           [dragulaModel]="componentTasks |  componentSearch : tagData.selected() : tagData.isNoTagSelected() : tagData.isSelectAll() | searchTextPipe  : componentFilter : ['name']">
                    <tr class="pointer d-flex me-auto"
                        *ngFor="let component of (componentTasks |  componentSearch : tagData.selected() : tagData.isNoTagSelected() : tagData.isSelectAll() | searchTextPipe  : componentFilter : ['name'])"
                        (click)="editComponentTask(component)"
                        [ngClass]="{'selected-component': editableComponent?.name === component.name || actionToEdit?.name === component.name}">
                        <td class="w-100">
                            <span class="fa" [ngClass]="component.implementation ? 'fa-clone' : 'fa-cubes'"></span>
                            {{component.name}}
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div *ngIf="!viewComponent" class="component-list"
             [ngClass]="{'d-none': componentMinimize}">
            <input name="search" type="text" class="sticky-content form-control mb-2"
                   placeholder="{{'components.action.list.filter.placeholder' | translate}}"
                   [(ngModel)]="taskFilter"/>
            <div class="table-scroll">
                <table class="table table-sm table-striped table-hover">
                    <tbody>
                    <tr *ngFor="let task of tasks | searchTextPipe: taskFilter:['identifier']" (click)="select(task)"
                        class="pointer"
                        [ngClass]="{'selected-component': task?.identifier === actionSelected?.identifier }">
                        <td> {{task.identifier}} </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="edition" [formGroup]="componentForm"
         [ngClass]="{'col edition-component-minimize':componentMinimize, 'col-9':!componentMinimize}">
        <div class="text-center bg-info text-white"
             [ngClass]="'bg-' + messageType">
            <strong *ngIf="message">{{ message }}</strong>
        </div>

        <!-- Component panel -->
        <ng-container *ngIf="viewComponent && !actionToEdit">
            <div class="edition-header row mt-0">
                <ng-container *ngIf="!executionResult && !editableComponent">
                    <div class="col text-center">
                        <button *hasAuthorization="[Authorization.COMPONENT_WRITE]"
                                type="button"
                                class="btn btn-success"
                                (click)="initNewComponent()"
                                title="{{'components.component.create' | translate}}">
                            <span class="fa fa-plus-circle"></span><br/>
                        </button>
                    </div>
                </ng-container>
                <ng-container *ngIf="editableComponent">
                    <div class="col-7">
                        <div class="row">
                            <div>
                                <span class="fa fa-cubes"></span>
                                <span class="ms-2 fw-bold">{{'components.menu.components' | translate}}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-1"></div>
                            <textarea formControlName="name" rows="2"
                                      class="col form-control no-resize"
                                      [ngClass]="{
                                        'is-valid': componentForm.get('name').valid && componentForm.get('name').enabled,
                                        'is-invalid': !componentForm.get('name').valid && componentForm.get('name').enabled
                                      }"
                                      placeholder="{{'components.shared.edition.fields.intention.placeholder' | translate}}">
                            </textarea>
                            <div class="col-1"></div>
                        </div>
                    </div>
                    <div class="col-5">
                        <div class="row">
                            <div class="col text-center">
                                <ng-container *hasAuthorization="[Authorization.COMPONENT_WRITE]">
                                    <chutney-toolbar-component
                                        (editEvent)="save()"
                                        (cancelEvent)="cancel()"
                                        (executeEvent)="execute($event)"
                                        (childEvent)="seeChild()"
                                        (deleteEvent)="deleteComponent(editableComponent.id)"
                                        (duplicateEvent)="duplicateComponent()"
                                        [editComponent]="editableComponent"
                                        [parents]="parents">
                                    </chutney-toolbar-component>
                                </ng-container>
                            </div>
                        </div>
                        <div class="row">
                            <div class="p-0 align-self-center">
                                <label class="form-control-label fw-bold"
                                       for="tags">{{ 'scenarios.edition.form.tags' | translate }}</label>
                            </div>
                            <div class="col">
                                <textarea formControlName="tags" type="text" class="form-control no-resize" name="tags"
                                          id="tags" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
            <div class="edition-body row">
                <div *ngIf="editableComponent" class="border-right"
                     [ngClass]="{'col edition-component-right-panel-minimize':componentEditionRightPanelMinimize, 'col-7':!componentEditionRightPanelMinimize}">
                        <div class="ps-3 fw-bold">
                            <span class="legend-title">{{'components.component.edition.blocks.steps' | translate}}</span>
                        </div>
                        <div class="bg-draggable mt-2 border"
                             title="{{'components.shared.edition.draganddrop' | translate}}">
                            <div [ngClass]="componentTasksCreated.length > 0 ? 'drop-zone' : 'drop-zone-empty'"
                                 dragula="COPYABLE"
                                 [(dragulaModel)]="componentTasksCreated" id="right">
                                <div *ngFor="let component of componentTasksCreated; let i=index" class="card mb-2">
                                    <chutney-component-card
                                        [component]="component"
                                        (deleteEvent)="removeStep(i)">
                                    </chutney-component-card>
                                </div>
                            </div>
                        </div>
                </div>
                <div [ngClass]="{'p-0 right-panel-minimize':componentEditionRightPanelMinimize, 'col-5':!componentEditionRightPanelMinimize}">
                    <button *ngIf="editableComponent" type="button" class="right-panel-minimize-btn btn btn-xs mt-4 btn-default shadow-none"
                            [ngClass]="{'p-0':!componentEditionRightPanelMinimize}"
                            title="{{(componentEditionRightPanelMinimize ? 'global.actions.show' : 'global.actions.hide') | translate}}"
                            (click)="componentEditionRightPanelMinimize = !componentEditionRightPanelMinimize;">
                        <span class="fa" [ngClass]="{'fa-angle-double-left':componentEditionRightPanelMinimize, 'fa-angle-double-right':!componentEditionRightPanelMinimize}"></span>
                    </button>
                    <div class="right-panel-content mt-4" [ngClass]="{'d-none':componentEditionRightPanelMinimize}">
                        <ng-container *ngIf="!executionResult">
                            <div *ngIf="editableComponent">
                                <chutney-strategy-form [strategy]="editableComponent.strategy" formControlName="strategy"></chutney-strategy-form>
                                <chutney-parameters-component [parentForm]="componentForm" [editableComponent]="editableComponent"></chutney-parameters-component>
                                <chutney-child-panel-component [parents]="parents" [show]="showChild"></chutney-child-panel-component>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="executionResult">
                            <chutney-execution-panel-component [executionResult]="executionResult" (closeEvent)="closeExecutionPanel()"></chutney-execution-panel-component>
                        </ng-container>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- Actions panel edit -->
        <ng-container *ngIf="viewComponent && actionToEdit">
            <chutney-action-edit-component
                [editComponent]="actionToEdit"
                [rightPanelMinimize]="componentEditionRightPanelMinimize"
                (createEvent)="saveComponent($event)"
                (deleteEvent)="deleteComponent($event)"
                (cancelEvent)="cancel()"
                (duplicateEvent)="duplicateAction()">
            </chutney-action-edit-component>
        </ng-container>

        <!-- Actions panel create -->
        <ng-container *ngIf="!viewComponent">
            <div *ngIf="!actionSelected" class="fw-bold text-center">
                {{'components.action.edition.select' | translate}}
            </div>
            <chutney-action-edit-component *ngIf="actionSelected"
                [editComponent]="actionToEdit"
                [rightPanelMinimize]="componentEditionRightPanelMinimize"
                (createEvent)="saveComponent($event)"
                (deleteEvent)="deleteComponent($event)"
                (cancelEvent)="cancel()">
            </chutney-action-edit-component>
        </ng-container>
    </div>
</div>
