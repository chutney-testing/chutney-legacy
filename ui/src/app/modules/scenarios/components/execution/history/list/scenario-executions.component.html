<div *ngIf="filtersForm" class="executions">
    <div [formGroup]="filtersForm">
        <div class="mb-3 row">
            <div class="col-3">
                <input id="keyword"
                       type="text"
                       class="form-control"
                       name="keyword"
                       placeholder="{{'global.actions.global-search' | translate}}"
                       formControlName="keyword">
            </div>
        </div>
        <table class="table table-hover table-borderless">
            <thead class="table-light text-center">
            <tr class="headers-labels">
                <th class="w1">#</th>
                <th scope="col">
                    <div class="d-flex justify-content-between">
                        <span>{{'scenarios.execution.history.status' | translate}}</span>
                        <i class="fa" [ngClass]="{
                        'fa-chevron-up': statusDropdown.isActive,
                        'fa-chevron-down': !statusDropdown.isActive}"
                           (click)="toggleDropDown(statusDropdown, $event)"></i>
                    </div>
                </th>
                <th scope="col">
                    <div class="d-flex justify-content-between">
                        <span>{{'scenarios.execution.history.date' | translate}}</span>
                        <i #dateToggleButton class="fa-regular fa-calendar-days" (click)="datepicker.toggle()"></i>
                    </div>
                </th>
                <th scope="col">
                    <div class="d-flex justify-content-between">
                        <span>{{'scenarios.execution.history.env' | translate}}</span>
                        <i class="fa" [ngClass]="{
                        'fa-chevron-up': envsDropdown.isActive,
                        'fa-chevron-down': !envsDropdown.isActive}"
                           (click)="toggleDropDown(envsDropdown, $event)"></i>
                    </div>
                </th>
                <th scope="col">
                    <div class="d-flex justify-content-between">
                        <span>{{'scenarios.execution.history.executor' | translate}}</span>
                        <i class="fa" [ngClass]="{
                        'fa-chevron-up': executorsDropdown.isActive,
                        'fa-chevron-down': !executorsDropdown.isActive}"
                           (click)="toggleDropDown(executorsDropdown, $event)"></i>
                    </div>

                </th>
                <th scope="col" class="">
                    <div class="d-flex justify-content-between">
                        <span> {{'scenarios.execution.history.campaign' | translate}}</span>
                        <i class="fa" [ngClass]="{
                        'fa-chevron-up': campsDropdown.isActive,
                        'fa-chevron-down': !campsDropdown.isActive}"
                           (click)="toggleDropDown(campsDropdown, $event)"></i>
                    </div>
                </th>
                <th scope="col">{{'scenarios.execution.history.report' | translate}}</th>
                <th scope="col" class="w1">&nbsp;</th>
            </tr>
            <tr class="headers-filters">
                <th></th>
                <th colspan="#ofColumnsToSpan">
                    <angular2-multiselect [data]="status"
                                          [settings]="selectSettings"
                                          formControlName="status"
                                          #statusDropdown>
                    </angular2-multiselect>
                </th>
                <th class="align-middle">
                    <div *ngIf="filtersForm.controls.date.value" (click)="filtersForm.get('date').reset()"
                         class="chutney-tag chutney-tag-selected">
                        {{ getDateFilterValue() | amDateFormat:'LL'}}
                        <i class="fa-regular fa-x fa-xs ms-2"></i>
                    </div>
                </th>
                <th>
                    <angular2-multiselect [data]="environments"
                                          [settings]="selectSettings"
                                          formControlName="environments"
                                          #envsDropdown>
                    </angular2-multiselect>
                </th>
                <th>
                    <angular2-multiselect [data]="executors"
                                          [settings]="selectSettings"
                                          formControlName="executors"
                                          #executorsDropdown>
                    </angular2-multiselect>
                </th>
                <th>
                    <angular2-multiselect [data]="campaigns"
                                          [settings]="selectSettings"
                                          formControlName="campaigns"
                                          #campsDropdown>
                    </angular2-multiselect>
                </th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody class="small">
            <tr *ngFor="let execution of filteredExecutions" class="text-center">
                <td class="align-middle">
                    <ngb-highlight [result]="execution.executionId.toString()"
                                   [term]="filtersForm.get('keyword').value">
                    </ngb-highlight>
                </td>
                <td class="align-middle">
                    <i class="fa-solid fa-lg"
                       [ngClass]="
                                {'fa-circle-check icon-info': execution.status === ExecutionStatus.SUCCESS,
                                'fa-circle-xmark icon-danger': execution.status === ExecutionStatus.FAILURE,
                                'fa-spinner fa-pulse icon-warning': execution.status === ExecutionStatus.RUNNING || execution.status === ExecutionStatus.PAUSED,
                                'fa-circle-exclamation icon-light': execution.status === ExecutionStatus.STOPPED}"
                    ></i>
                </td>
                <td class="text-start">
                    <ngb-highlight [result]="execution.time | amCalendar"
                                   [term]="filtersForm.get('keyword').value">
                    </ngb-highlight>
                    <div>
                        <small>({{ 'global.time.in' | translate }} {{execution.duration | amDuration:'ms' }})</small>
                    </div>
                </td>
                <td>
                    <ngb-highlight [result]="execution.environment"
                                   [term]="filtersForm.get('keyword').value"></ngb-highlight>
                </td>
                <td>
                    <ngb-highlight [result]="execution.user" [term]="filtersForm.get('keyword').value"></ngb-highlight>
                </td>
                <td>
                    <a [routerLink]="['/campaign', execution.campaignReport?.campaignId, 'execution', execution.campaignReport?.executionId]">
                        <ngb-highlight [result]="execution.campaignReport?.campaignName"
                                       [term]="filtersForm.get('keyword').value"></ngb-highlight>
                    </a>
                </td>
                <td>
                    <ngb-highlight [result]="execution.error"
                                   [term]="filtersForm.get('keyword').value"></ngb-highlight>
                </td>
                <td class="align-middle">
                    <i class="fa fa-eye icon-primary pointer fa-lg"
                       (click)="openReport(execution, !$event.ctrlKey)"></i>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="input-group ">
            <input class="form-control d-none"
                   name="datepicker"
                   ngbDatepicker
                   #datepicker="ngbDatepicker"
                   formControlName="date"
                   [readonly]="true"
                   (click)="datepicker.toggle()"
                   [positionTarget]="dateToggleButton"
                   [markDisabled]="noExecutionAt()"
                   placement="bottom-end">
        </div>
    </div>
</div>



